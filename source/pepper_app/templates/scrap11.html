<!DOCTYPE html>
<head>
    <link rel="shortcut icon" href="">
    <title>{% block title %}{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <style>
        .frame {
            border: 1px solid black;
            padding: 10px;
            width: 300px;
        }

        .content {
            border: 1p
        }
    </style>
</head>

<body>
{% block content %}
<div class="desc_box">Select data to scra6pe.</div>
<div class="frame">
    <form id="form_id" name="form">
        {% csrf_token %}
        {{ scraping_request_form.as_p}}
        <button type="button" id="ajaxButton">Submit</button>
         
    </form>    
          

    
</div>
{% if scraping_in_progress %}
<div>
    Scraping in progress...
    {{task_id}}
</div>
{% endif %}
{% if scraping_finished %}
<div>{{ result }}</div>
{% endif %}
{% endblock content %}

{% block javascript %}
<script>
     // Function to check the session value and redirect if necessary
     var task_id = "{{ task_id }}";
     
     
     function checkSessionValue() {
        $.ajax({
            url: '/scrap_status/' + task_id + '/',  // Change this to the URL of your Django view
            type: 'GET',
            success: function (data) {
                var sessionValue = "{{ result }}";
                var sessionValue2 = "{{ end }}";
                var sessionValue3 = "{{ scraping_in_progress }}";
                var sessionValue4 = "{{ scraping_finished }}";
                

                // Check if the session value is the one you're looking for
                if ("{{ result }}" !== false & "{{ end }}" == true ) {
                    // Redirect the user to a new page
                    alert("Yea!");
                    window.location.href = '/scrap/';
                    
                }

            },
            error: function (xhr, status, error) {
                    console.error('AJAX request failed:', status, error);
                }
        });
        
    }

    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('form_id');
        const submitButton = document.getElementById('ajaxButton');

        submitButton.addEventListener('click', function () {
            const formData = new FormData(form);

            fetch('/scrap/', {
                method: 'POST',
                body: formData,
            })

            .catch(error => console.error('Error:', error));
        });
    });

</script>
<script>

    // Periodically check the session value every 5 seconds (adjust as needed)
    $('#ajaxButton').click(function () {
        
        // Call the AJAX function on button click
        checkSessionValue();
        });

     // Click event handler for the butt
</script>
{% endblock javascript %}
</body>