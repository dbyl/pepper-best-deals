<head>
    <title>{% block title %}{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <style>
        .frame {
            border: 1px solid black;
            padding: 10px;
            width: 300px;
        }

        .content {
            border: 1p
        }
    </style>
</head>

<body>
{% block content %}
<div class="desc_box">Select data to scrape.</div>
<div class="frame">
    <form method="POST" name="form" action="{% url 'scrap' %}">
        {% csrf_token %}
        {{ scraping_request_form.as_p}}
        <div class="button_box">
            <button id="ajaxButton">Submit</button>
        </div>
    </form>
</div>
{% if scraping_in_progress %}
<div>
    Scraping in progress...
    {{task_id}}
</div>
{% endif %}
{% if scraping_finished %}
<div>{{ result }}</div>
{% endif %}
{% endblock content %}

{% block javascript %}
<script type="text/javascript">
     // Function to check the session value and redirect if necessary
     var task_id = "{{ task_id }}";

     setInterval(function checkSessionValue() {
        $.ajax({
            url: '/scrap_status/' + task_id + '/',  // Change this to the URL of your Django view
            type: 'GET',
            success: function (data) {
                var sessionValue = data.result;

                // Check if the session value is the one you're looking for
                if (sessionValue !== false) {
                    // Redirect the user to a new page
                    window.location.href = '/scrap/';
                    clearInterval();
                }
            },
            error: function (error) {
                console.error('Error checking session value:', error);
            }
        });
        
    }, 2000
     );

    // Periodically check the session value every 5 seconds (adjust as needed)
</script>
<script>

     // Click event handler for the button
  $('#ajaxButton').on('click', function() {
    // Call the AJAX function
    checkSessionValue();
  });
</script>
{% endblock javascript %}
</body>